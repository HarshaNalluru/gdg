var vcap = require('./index.js')
var path = require('path')

var client = new vcap.Client('http://api.thepumpkin.cloudfoundry.me')
//client.login("thepumpkin1979@gmail.com","gTdDtTz9",function(err, token) {
client.login("thepumpkin1979@gmail.com","programador",function(err, token) {
	if(err) {
		console.warn("login error", err)
	} else {
		console.warn("Authenticated!!!", token)
		client.getApps(function(err, apps) {
			if(err) {
				console.warn("getApps error", err)
			}else {
				console.warn("getApps", apps)
				var appName = "someapp"
				client.createApp({
					resources: {
						memory: 64
					},
					staging: {
						runtime: null,
						framework: "node"
					},
					uris: [appName + '.' + client.endpoint],
					instances: 1,
					name: "someapp"
				}, function(error) {
					if(error) {
						console.warn("create app error", error)
					} else {
						console.warn("app created successfully")
						
						client.updateAppSources("/Users/thepumpkin/Projects/testVCAPSImple/", appName,[], function(error) {
							if(error) {
								console.warn("upload app error", error)
							} else {
								console.warn("app uploaded successfully")
								
								client.getApp(appName, function(err, manifest) {
									if(error) {
										console.warn("getApp app error", err)
									} else {
										console.warn("manifest", manifest)
										manifest.state = 'STARTED'
										client.updateApp(appName, manifest, function(error) {
											if(error) {
												console.warn("updateApp app error", error)
											} else {
												console.warn("Application Started")
											}
										})
									}
								})
							}
						})
					}
				})
			}
		})
	}
})